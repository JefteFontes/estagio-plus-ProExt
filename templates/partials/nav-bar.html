{% load static %}
<header class="navbar-dashboard">
    <div class="logo">
        {% if request.user.is_authenticated and request.user.coordenadorextensao.instituicao.logo %}
            <img src="{{ request.user.coordenadorextensao.instituicao.logo.url }}" alt="Logo da Instituição">
        {% else %}
            <img src="{% static 'img/logo.png' %}" alt="Logo +Estágio">
        {% endif %}
    </div>
    <nav class="navbar-nav">
        {% url 'account_login' as login_url_ %}
        {% if user.is_authenticated %}
        <div class="navbar-user">
            <div class="notif">
                <div class="notif-item">
                    <button title="Notificação" class="notif-btn" id="notifDropdownButton" onclick="toggleNotifSidebar()">
                        <i class="fa-regular fa-bell"></i>
                        {% if relatorios_pendentes_count > 0 %}
                            <span class="notification-badge">{{ relatorios_pendentes_count }}</span>
                        {% endif %}
                    </button>
                </div>
            </div>
            <div class="user-info">
                <span class="initials-user">{{ request.user.username|slice:":2"|upper }}</span>
                <span class="user-name">{{ request.user.username }}</span>
                <div class="user-dropdown">
                    <button title="User logout-edit" class="user-button" onclick="toggleDropdown()" id="userDropdownButton">
                        <i class="fa-solid fa-chevron-down"></i>
                    </button>
                    <div id="myDropdown" class="dropdown-content">
                        <button class="btn-logout" id="openModal">Logout</button>
                        <a href="{% url 'editar_perfil' %}">
                            <button class="btn-editar" id="openModal2">Editar Perfil</button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
            {% else %}
            <div class="navbar-menu">
                {% url 'home' as inicio_url_ %}
                {% if inicio_url_ %}
                    <a href="{{ inicio_url_ }}">Inicio</a>
                {% endif %}
                {% if login_url_ %}
                    <a href="{{ login_url_ }}">Login</a>
                {% endif %}
                <a href="#">Contato</a>
                <a href="#">Sobre</a>
            </div>
        {% endif %}
    </nav>
</header>

<div id="notificationSidebar" class="notification-sidebar">
    <div class="notification-header">
        <div class="header-content">
            <h3>
                <i class="fas fa-bell"></i>
                Notificações
            </h3>
        </div>
        <div class="notification-summary">
            <span class="badge {% if relatorios_pendentes_count == 0 %}empty{% endif %}">
                {{ relatorios_pendentes_count }} {{ relatorios_pendentes_count|pluralize:"pendência,pendências" }}
            </span>
            {% if urgent_count > 0 %}
                <span class="urgent-count">
                    <i class="fas fa-exclamation-triangle"></i> {{ urgent_count }} urgente(s)
                </span>
            {% endif %}
        </div>
    </div>
    
    <div class="notification-content">
        {% if relatorios_pendentes_count > 0 %}
            <div class="notification-list">
                {% for estagiario in relatorios_list %}
                    <div class="estagiario-group">
                        <div class="estagiario-header">
                            <h4>{{ estagiario.nome }}</h4>
                            <span class="estagiario-meta">
                                {{ estagiario.curso }} | {{ estagiario.empresa }}
                            </span>
                        </div>
                        
                        <div class="relatorio-list">
                            {% for relatorio in estagiario.relatorios %}
                                <div class="relatorio-item {% if relatorio.urgente %}urgent{% endif %}">
                                    <div class="relatorio-icon">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <div class="relatorio-details">
                                        <div class="relatorio-title">{{ relatorio.tipo }}</div>
                                        <div class="relatorio-info">
                                            <span class="relatorio-date">
                                                <i class="far fa-calendar-alt"></i> 
                                                {{ relatorio.data_prevista }}
                                            </span>
                                            <span class="relatorio-status {{ relatorio.status }}">
                                                {% if relatorio.status == 'atrasado' %}
                                                    <i class="fas fa-clock"></i> Atrasado há {{ relatorio.dias_atraso }} dias
                                                {% else %}
                                                    <i class="far fa-clock"></i> A vencer
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="relatorio-actions">
                                        <a href="{% url 'detalhes_estagio' %}?selected={{ relatorio.estagio_id }}" class="btn-action" title="Ver detalhes">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-notifications">
                <div class="empty-state">
                    <i class="far fa-check-circle"></i>
                    <h4>Tudo em dia!</h4>
                    <p>Nenhum relatório pendente no momento.</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>