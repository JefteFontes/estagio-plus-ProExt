{% extends "dashboard/base.html" %}

{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <strong>{{ message }}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="dashboard-title">Estagiários</h1>
        <div class="search-container">
            <input type="text" placeholder="Buscar por empresa, estagiário ou curso..." class="search-input">
            <button class="search-button">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>

    <div class="controls-container">
        <h2 class="section-title"></h2>
        <div class="actions">
            <button id="toggle-filters" class="btn-filter">
                <i class="fas fa-filter"></i> Filtros
            </button>
            <a href="{% url 'cadastrar_estagiario' %}" class="btn-add">
                <i class="fas fa-plus"></i> Cadastrar Novo Estagiário
            </a>
        </div>
    </div>

    <!-- Filtros (inicialmente escondidos) -->
    <div id="filters-container" class="filters-container" style="display: none;">
        <form method="GET" class="filters-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="search">Nome</label>
                    <input type="text" name="search" id="search" class="form-control" 
                    placeholder="Buscar por nome" value="{{ request.GET.search }}">
                </div>
                
                <div class="filter-group">
                    <label for="search-matricula">Matrícula</label>
                    <input type="text" name="search-matricula" id="search-matricula" class="form-control" 
                    placeholder="Buscar por matrícula" value="{{ request.GET.search_matricula }}">
                </div>
                
                <div class="filter-group">
                    <label for="curso">Curso</label>
                    <select name="curso" id="curso" class="form-select">
                        <option value="">Todos os cursos</option>
                        {% for curso in cursos %}
                            <option value="{{ curso }}" {% if curso == request.GET.curso %}selected{% endif %}>
                                {{ curso }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button type="submit" class="btn-apply">
                    <i class="fas fa-check"></i> Aplicar Filtros
                </button>
                <button type="button" id="reset-filters" class="btn-reset">
                    <i class="fas fa-times"></i> Limpar Filtros
                </button>
            </div>
        </form>
    </div>

    <div class="stats-container">
        <span class="stats-badge">{{ estagiarios|length }} estagiários cadastrados</span>
    </div>

    {% if estagiarios %}
    <div class="cards-container">
        {% for estagiario in estagiarios %}
        <div class="intern-card">
            <div class="card-header">
                <span class="initials">{{ estagiario.nome_completo|slice:":2"|upper }}</span>
                <h3 class="intern-name">{{ estagiario.nome_completo }}</h3>
            </div>
            <div class="card-body">
                <div class="info-row">
                    <span class="info-label">Matrícula:</span>
                    <span class="info-value">{{ estagiario.matricula }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Curso:</span>
                    <span class="info-value">{{ estagiario.curso }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ estagiario.email }}</span>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'editar_estagiario' estagiario.id %}" class="btn-action edit">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{% url 'deletar_estagiario' estagiario.id %}" class="btn-action delete">
                    <i class="fas fa-trash"></i> Excluir
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-user-graduate empty-icon"></i>
        <p>Não há estagiários cadastrados.</p>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleFiltersBtn = document.getElementById('toggle-filters');
    const filtersContainer = document.getElementById('filters-container');
    const resetFiltersBtn = document.getElementById('reset-filters');
    
    // Toggle dos filtros
    toggleFiltersBtn.addEventListener('click', function() {
        if (filtersContainer.style.display === 'none') {
            filtersContainer.style.display = 'block';
            toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Ocultar Filtros';
        } else {
            filtersContainer.style.display = 'none';
            toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Filtros';
        }
    });
    
    // Reset dos filtros
    resetFiltersBtn.addEventListener('click', function() {
        document.querySelectorAll('.filters-form input, .filters-form select').forEach(element => {
            if (element.tagName === 'INPUT') {
                element.value = '';
            } else if (element.tagName === 'SELECT') {
                element.selectedIndex = 0;
            }
        });
    });
    
    // Mostrar filtros se algum estiver aplicado
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('search') || urlParams.has('search_matricula') || urlParams.has('curso')) {
        filtersContainer.style.display = 'block';
        toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Ocultar Filtros';
    }
});
</script>
{% endblock %}