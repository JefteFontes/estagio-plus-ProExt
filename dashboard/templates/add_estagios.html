{% extends "dashboard/base.html" %}

{% block content %}

<div class="cadastro-container-dashboard">
<h2>Cadastro de Estágio</h2>
<form method="post">
  {% csrf_token %}

  {% if form.errors %}
    <div class="form-errors">
        <p class="error-message">Por favor, corrija os seguintes erros:</p>
        <ul>
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <li class="error-message"> {{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}
<p>Dados estágio:</p>
<div class="form-coordenador">
  <div class="form-linha1">
    <div class="form-inicial">
      <label for="{{ form.estagiario.id_for_label }}" class="form-label">Estagiário:</label>
      {{ form.estagiario }}
    </div>

    <div class="form-inicial">
      <label for="{{ form.empresa.id_for_label }}" class="form-label">Empresa:</label>
      {{ form.empresa }}
    </div>

    <div class="form-inicial">
      <label for="{{ form.instituicao.id_for_label }}" class = "form-label">Insittuição:</label>
      {{ form.instituicao }}
    </div>

    <div class="form-inicial">
      <label for="{{ form.supervisor.id_for_label }}" class="form-label">Supervisor:</label>
      {{ form.supervisor }}
    </select>
    </div>

    <div class="form-linha1">
      <div class="form-inicial {% if form.turno.errors %}has-error{% endif %}">
        <label for="{{ form.turno.id_for_label }}" class="form-label">Turno:</label>
        {{ form.turno }}
        {% for error in form.turno.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-inicial {% if form.area.errors %}has-error{% endif %}">
        <label for="{{ form.area.id_for_label }}" class="form-label">Área:</label>
        {{ form.area }}
        {% for error in form.area.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-inicial {% if form.tipo_estagio.errors %}has-error{% endif %}">
        <label for="{{ form.tipo_estagio.id_for_label }}" class="form-label">Tipo:</label>
        {{ form.tipo_estagio }}
        {% for error in form.tipo_estagio.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="form-linha1">
      <div class="form-inicial">
        <label for="{{ form.bolsa_estagio.id_for_label }}" class="form-label">Bolsa de Estágio:</label>
        {{ form.bolsa_estagio }}
        
      </div>
      <div class="form-inicial {% if form.auxilio_transporte.errors %}has-error{% endif %}">
        <label for="{{ form.auxilio_transporte.id_for_label }}" class="form-label">Auxílio Transporte:</label>
        {{ form.auxilio_transporte }}
        {% for error in form.auxilio_transporte.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-inicial {% if form.data_inicio.errors %}has-error{% endif %}">
        <label for="{{ form.data_inicio.id_for_label }}" class="form-label">Data Início:</label>
        {{ form.data_inicio }}
        {% for error in form.data_inicio.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-inicial {% if form.data_fim.errors %}has-error{% endif %}">
        <label for="{{ form.data_fim.id_for_label }}" class="form-label">Data de Término:</label>
        {{ form.data_fim }}
        
        {% for error in form.data_fim.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="form-linha1">
      <div class="form-inicial {% if form.descricao.errors %}has-error{% endif %}">
        <label for="{{ form.descricao.id_for_label }}" class="form-label">Descrição:</label>
        {{ form.descricao }}
        {% for error in form.descricao.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-inicial {% if form.status.errors %}has-error{% endif %}">
        <label for="{{ form.status.id_for_label }}" class="form-label">Ativo:</label>
        {{ form.status }}
        {% for error in form.status.errors %}
        <div class="error-message">{{ error }}</div>
        {% endfor %}
      </div>
    </div>
  </div>
  <button class="btn-user-signup" type="submit" name="cadastrar_estagio">Cadastrar</button>
</form>
</div>
{% endblock %}




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    $("#empresa-select").change(function () {
        var empresaId = $(this).val();
        if (empresaId) {
            $.ajax({
                url: "{% url 'get_supervisores' %}",
                data: { empresa_id: empresaId },
                success: function (data) {
                    var supervisorSelect = $("#supervisor-select");
                    supervisorSelect.empty();
                    data.forEach(function (supervisor) {
                        supervisorSelect.append(
                            '<option value="">' + supervisor.primeiro_nome + ' ' + supervisor.sobrenome + '</option>'
                        );
                    });
                },
            });
        } 
    });
});
</script>
<script>
  $(document).ready(function(){
    $("#form.data_fim").change(function(){
      const dataInicio = $("#id_data_inicio").val();
      const dataFim = $(this).val();
      const dataHoje = new Date();
      const status = $("#id_status").val();

      dataHoje = dataHoje.toISOString().split("T")[0];
      if (dataInicio && dataFim) {
        const dataInicioObj = new Date(dataInicio);
        const dataFimObj = new Date(dataFim);

        if (dataFimObj < dataInicioObj) {
          alert("Data de término deve ser maior que a data de início!");
          $(this).val("");
        }
        elif(dataFimObj < dataHoje){
          status = 1;
          $("#id_status").val(status);
        elif(dataFimObj > dataHoje){
          status = 0;
          $("#id_status").val(status);
                  }

      }
    });
  })
  </script>
  <script>
  $(document).ready(function(){
    $("#id_bolsa_estagio").change(function(){
      const bolsa = $(this).val();
      if(bolsa <=0){
        alert("Bolsa de estágio deve ser maior que 0!");
        $(this).val("");
      } })
    })
  </script>
      
  $(document).ready(function(){
    $("#form.auxilio_transporte").change(function(){
      const bolsa = $(this).val();
      if(bolsa < 0){
        alert("Auxílio transporte deve ser maior ou igual a 0!");
        $(this).val("");
      } })
    })
 
</script>
