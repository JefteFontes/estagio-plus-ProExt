{% extends "dashboard/base.html" %}

{% block content %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <strong>{{ message }}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="dashboard-title">Dashboard</h1>
        <div class="search-container">
            <input type="text" placeholder="Buscar por empresa, estagiário ou curso..." class="search-input">
            <button class="search-button">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>

    <div class="controls-container">
        <h2 class="section-title">Empresas</h2>
        <div class="actions">
            <button id="toggle-filters" class="btn-filter">
                <i class="fas fa-filter"></i> Filtros
            </button>
            <a href="{% url 'cadastrar_empresa' %}" class="btn-add">
                <i class="fas fa-plus"></i> Cadastrar Nova Empresa
            </a>
        </div>
    </div>

    <!-- Filtros (inicialmente escondidos) -->
    <div id="filters-container" class="filters-container" style="display: none;">
        <form method="GET" class="filters-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="search">Nome/CNPJ</label>
                    <input type="text" name="search" id="search" class="form-control" 
                           placeholder="Buscar por nome ou CNPJ" value="{{ request.GET.search }}">
                </div>
                
                <div class="filter-group">
                    <label for="cidade">Cidade</label>
                    <select name="cidade" id="cidade" class="form-select">
                        <option value="">Todas as cidades</option>
                        {% for cidade in cidades %}
                            <option value="{{ cidade }}" {% if cidade == request.GET.cidade %}selected{% endif %}>
                                {{ cidade }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button type="submit" class="btn-apply">
                    <i class="fas fa-check"></i> Aplicar Filtros
                </button>
                <button type="button" id="reset-filters" class="btn-reset">
                    <i class="fas fa-times"></i> Limpar Filtros
                </button>
            </div>
        </form>
    </div>

    <div class="stats-container">
        <span class="stats-badge">{{ empresas|length }} empresas cadastradas</span>
    </div>

    {% if empresas %}
    <div class="cards-container">
        {% for empresa in empresas %}
        <div class="company-card">
            <div class="card-header">
                <span class="initials">{{ empresa.empresa_nome|slice:":2"|upper }}</span>
                <h3 class="company-name">{{ empresa.empresa_nome }}</h3>
            </div>
            <div class="card-body">
                <div class="info-row">
                    <span class="info-label">CNPJ:</span>
                    <span class="info-value">{{ empresa.cnpj }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Endereço:</span>
                    <span class="info-value">{{ empresa.endereco.rua }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cidade:</span>
                    <span class="info-value">{{ empresa.endereco.cidade }}</span>
                </div>
            </div>
            <div class="card-footer">
                <a href="{% url 'editar_empresa' empresa.id %}" class="btn-action edit">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{% url 'deletar_empresa' empresa.id %}" class="btn-action delete">
                    <i class="fas fa-trash"></i> Excluir
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-building empty-icon"></i>
        <p>Não há empresas cadastradas.</p>
    </div>
    {% endif %}
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleFiltersBtn = document.getElementById('toggle-filters');
        const filtersContainer = document.getElementById('filters-container');
        const resetFiltersBtn = document.getElementById('reset-filters');
        
        // Toggle dos filtros
        toggleFiltersBtn.addEventListener('click', function() {
            if (filtersContainer.style.display === 'none') {
                filtersContainer.style.display = 'block';
                toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Ocultar Filtros';
            } else {
                filtersContainer.style.display = 'none';
                toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Filtros';
            }
        });
        
        // Reset dos filtros
        resetFiltersBtn.addEventListener('click', function() {
            document.querySelectorAll('.filters-form input, .filters-form select').forEach(element => {
                if (element.tagName === 'INPUT') {
                    element.value = '';
                } else if (element.tagName === 'SELECT') {
                    element.selectedIndex = 0;
                }
            });
        });
        
        // Mostrar filtros se algum estiver aplicado
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('area') || urlParams.has('coordenador')) {
            filtersContainer.style.display = 'block';
            toggleFiltersBtn.innerHTML = '<i class="fas fa-filter"></i> Ocultar Filtros';
        }
    });
</script>
{% endblock %}